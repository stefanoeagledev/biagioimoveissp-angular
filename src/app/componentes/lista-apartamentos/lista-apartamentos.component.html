<!-- src/app/componentes/lista-apartamentos/lista-apartamentos.component.html -->

<div class="caixa-filtros">
  <!-- ==================== FILTRO POR BAIRRO (autocomplete) ==================== -->
  <div class="filtro-bairro">
    <label for="bairro-input">Bairro:</label>
    <input
      id="bairro-input"
      list="bairros-list"
      placeholder="Escolha ou digite um bairro"
      [ngModel]="filtroAtual().bairro || ''"
      (ngModelChange)="onBairroChange($any($event))"
    />
    <datalist id="bairros-list">
      <option *ngFor="let b of bairrosDisponiveis()" [value]="b"></option>
    </datalist>
  </div>

  <!-- ==================== ORDENAR ==================== -->
  <div class="filtro-sort">
    <label for="sort-select">Ordenar por:</label>
    <select
      id="sort-select"
      [ngModel]="filtroAtual().sortOrder || ''"
      (ngModelChange)="onSortChange($any($event))"
    >
      <option value="">Sem ordenação</option>
      <option value="preco-asc">Preço (menor → maior)</option>
      <option value="preco-desc">Preço (maior → menor)</option>
      <option value="area-asc">Área (menor → maior)</option>
      <option value="area-desc">Área (maior → menor)</option>
      <option value="quartos-asc">Quartos (menor → maior)</option>
      <option value="quartos-desc">Quartos (maior → menor)</option>
    </select>
  </div>

  <!-- ==================== CHIPS DE FILTROS ATIVOS ==================== -->
  <div
    class="filtros-ativos"
    *ngIf="(filtroAtual() | json) !== '{}'; else nenhumFiltro"
  >
    <!-- Bairro -->
    <span class="chip" *ngIf="filtroAtual().bairro">
      Bairro: {{ filtroAtual().bairro }}
      <button (click)="removeFiltro('bairro')">×</button>
    </span>

    <!-- Área -->
    <span
      class="chip"
      *ngIf="filtroAtual().minArea != null || filtroAtual().maxArea != null"
    >
      Área: {{ filtroAtual().minArea ?? areaDom().min }} –
      {{ filtroAtual().maxArea ?? areaDom().max }}
      <button (click)="removeFiltro('minArea'); removeFiltro('maxArea')">
        ×
      </button>
    </span>

    <!-- Quartos -->
    <span
      class="chip"
      *ngIf="
        filtroAtual().minQuartos != null || filtroAtual().maxQuartos != null
      "
    >
      Quartos: {{ filtroAtual().minQuartos ?? quartosDom().min }} –
      {{ filtroAtual().maxQuartos ?? quartosDom().max }}
      <button (click)="removeFiltro('minQuartos'); removeFiltro('maxQuartos')">
        ×
      </button>
    </span>

    <!-- Suítes -->
    <span
      class="chip"
      *ngIf="filtroAtual().minSuites != null || filtroAtual().maxSuites != null"
    >
      Suítes: {{ filtroAtual().minSuites ?? suitesDom().min }} –
      {{ filtroAtual().maxSuites ?? suitesDom().max }}
      <button (click)="removeFiltro('minSuites'); removeFiltro('maxSuites')">
        ×
      </button>
    </span>

    <!-- Banheiros -->
    <span
      class="chip"
      *ngIf="
        filtroAtual().minBanheiros != null || filtroAtual().maxBanheiros != null
      "
    >
      Banheiros: {{ filtroAtual().minBanheiros ?? banheirosDom().min }} –
      {{ filtroAtual().maxBanheiros ?? banheirosDom().max }}
      <button
        (click)="removeFiltro('minBanheiros'); removeFiltro('maxBanheiros')"
      >
        ×
      </button>
    </span>

    <!-- Lavabos -->
    <span
      class="chip"
      *ngIf="
        filtroAtual().minLavabos != null || filtroAtual().maxLavabos != null
      "
    >
      Lavabos: {{ filtroAtual().minLavabos ?? lavabosDom().min }} –
      {{ filtroAtual().maxLavabos ?? lavabosDom().max }}
      <button (click)="removeFiltro('minLavabos'); removeFiltro('maxLavabos')">
        ×
      </button>
    </span>

    <!-- Vagas -->
    <span
      class="chip"
      *ngIf="filtroAtual().minVagas != null || filtroAtual().maxVagas != null"
    >
      Vagas: {{ filtroAtual().minVagas ?? vagasDom().min }} –
      {{ filtroAtual().maxVagas ?? vagasDom().max }}
      <button (click)="removeFiltro('minVagas'); removeFiltro('maxVagas')">
        ×
      </button>
    </span>

    <!-- Preço -->
    <span
      class="chip"
      *ngIf="filtroAtual().minPreco != null || filtroAtual().maxPreco != null"
    >
      Preço: R$ {{ filtroAtual().minPreco ?? precoDom().min }} –
      {{ filtroAtual().maxPreco ?? precoDom().max }}
      <button (click)="removeFiltro('minPreco'); removeFiltro('maxPreco')">
        ×
      </button>
    </span>

    <!-- Amenidades -->
    <span class="chip" *ngFor="let am of filtroAtual().amenidades || []">
      Amenidade: {{ getAmenidadeNome(am) }}
      <button (click)="onAmenidadeToggle(am, false)">×</button>
    </span>

    <!-- SortOrder -->
    <span *ngIf="filtroAtual().sortOrder" class="chip">
      Ordenar por: {{ getSortLabel(filtroAtual().sortOrder) }}
      <button (click)="removeFiltro('sortOrder')">×</button>
    </span>
  </div>
  <ng-template #nenhumFiltro></ng-template>

  <!-- ==================== CHECKBOXES DE AMENIDADES ==================== -->
  <div class="filtro-amenidades">
    <h4>Amenidades</h4>
    <div class="checkbox-amenidade" *ngFor="let am of amenidadesDisponiveis()">
      <label>
        <input
          type="checkbox"
          [checked]="
            filtroAtual().amenidades
              ? filtroAtual().amenidades?.includes(am.iconKey)
              : false
          "
          (change)="onAmenidadeToggle(am.iconKey, $any($event.target).checked)"
        />
        {{ am.nome }}
      </label>
    </div>
  </div>

  <!-- ==================== SLIDERS + INPUTS NUMÉRICOS ==================== -->
  <!-- ÁREA -->
  <div class="filtro-intervalo">
    <label>Área (m²):</label>
    <div class="intervalo-inputs">
      <input
        type="number"
        [min]="areaDom().min"
        [max]="areaDom().max"
        [(ngModel)]="selArea().min"
        (ngModelChange)="onAreaMinChange($any($event))"
      />
      <span> até </span>
      <input
        type="number"
        [min]="areaDom().min"
        [max]="areaDom().max"
        [(ngModel)]="selArea().max"
        (ngModelChange)="onAreaMaxChange($any($event))"
      />
    </div>
    <div class="range-container">
      <input
        type="range"
        [min]="areaDom().min"
        [max]="areaDom().max"
        [step]="1"
        [(ngModel)]="selArea().min"
        (input)="onAreaMinChange($any($event.target).valueAsNumber)"
        [ngStyle]="{
          '--thumb-min':
            ((selArea().min - areaDom().min) * 100) /
              (areaDom().max - areaDom().min) +
            '%'
        }"
        [style.zIndex]="1"
      />
      <input
        type="range"
        [min]="areaDom().min"
        [max]="areaDom().max"
        [step]="1"
        [(ngModel)]="selArea().max"
        (input)="onAreaMaxChange($any($event.target).valueAsNumber)"
        [ngStyle]="{
          '--thumb-max':
            ((selArea().max - areaDom().min) * 100) /
              (areaDom().max - areaDom().min) +
            '%'
        }"
        [style.zIndex]="2"
      />
    </div>
  </div>

  <!-- QUARTOS -->
  <div class="filtro-intervalo">
    <label>Quartos:</label>
    <div class="intervalo-inputs">
      <input
        type="number"
        [min]="quartosDom().min"
        [max]="quartosDom().max"
        [(ngModel)]="selQuartos().min"
        (ngModelChange)="onQuartosMinChange($any($event))"
      />
      <span> até </span>
      <input
        type="number"
        [min]="quartosDom().min"
        [max]="quartosDom().max"
        [(ngModel)]="selQuartos().max"
        (ngModelChange)="onQuartosMaxChange($any($event))"
      />
    </div>
    <div class="range-container">
      <input
        type="range"
        [min]="quartosDom().min"
        [max]="quartosDom().max"
        [step]="1"
        [(ngModel)]="selQuartos().min"
        (input)="onQuartosMinChange($any($event.target).valueAsNumber)"
        [ngStyle]="{
          '--thumb-min':
            ((selQuartos().min - quartosDom().min) * 100) /
              (quartosDom().max - quartosDom().min) +
            '%'
        }"
        [style.zIndex]="1"
      />
      <input
        type="range"
        [min]="quartosDom().min"
        [max]="quartosDom().max"
        [step]="1"
        [(ngModel)]="selQuartos().max"
        (input)="onQuartosMaxChange($any($event.target).valueAsNumber)"
        [ngStyle]="{
          '--thumb-max':
            ((selQuartos().max - quartosDom().min) * 100) /
              (quartosDom().max - quartosDom().min) +
            '%'
        }"
        [style.zIndex]="2"
      />
    </div>
  </div>

  <!-- SUÍTES -->
  <div class="filtro-intervalo">
    <label>Suítes:</label>
    <div class="intervalo-inputs">
      <input
        type="number"
        [min]="suitesDom().min"
        [max]="suitesDom().max"
        [(ngModel)]="selSuites().min"
        (ngModelChange)="onSuitesMinChange($any($event))"
      />
      <span> até </span>
      <input
        type="number"
        [min]="suitesDom().min"
        [max]="suitesDom().max"
        [(ngModel)]="selSuites().max"
        (ngModelChange)="onSuitesMaxChange($any($event))"
      />
    </div>
    <div class="range-container">
      <input
        type="range"
        [min]="suitesDom().min"
        [max]="suitesDom().max"
        [step]="1"
        [(ngModel)]="selSuites().min"
        (input)="onSuitesMinChange($any($event.target).valueAsNumber)"
        [ngStyle]="{
          '--thumb-min':
            ((selSuites().min - suitesDom().min) * 100) /
              (suitesDom().max - suitesDom().min) +
            '%'
        }"
        [style.zIndex]="1"
      />
      <input
        type="range"
        [min]="suitesDom().min"
        [max]="suitesDom().max"
        [step]="1"
        [(ngModel)]="selSuites().max"
        (input)="onSuitesMaxChange($any($event.target).valueAsNumber)"
        [ngStyle]="{
          '--thumb-max':
            ((selSuites().max - suitesDom().min) * 100) /
              (suitesDom().max - suitesDom().min) +
            '%'
        }"
        [style.zIndex]="2"
      />
    </div>
  </div>

  <!-- BANHEIROS -->
  <div class="filtro-intervalo">
    <label>Banheiros:</label>
    <div class="intervalo-inputs">
      <input
        type="number"
        [min]="banheirosDom().min"
        [max]="banheirosDom().max"
        [(ngModel)]="selBanheiros().min"
        (ngModelChange)="onBanheirosMinChange($any($event))"
      />
      <span> até </span>
      <input
        type="number"
        [min]="banheirosDom().min"
        [max]="banheirosDom().max"
        [(ngModel)]="selBanheiros().max"
        (ngModelChange)="onBanheirosMaxChange($any($event))"
      />
    </div>
    <div class="range-container">
      <input
        type="range"
        [min]="banheirosDom().min"
        [max]="banheirosDom().max"
        [step]="1"
        [(ngModel)]="selBanheiros().min"
        (input)="onBanheirosMinChange($any($event.target).valueAsNumber)"
        [ngStyle]="{
          '--thumb-min':
            ((selBanheiros().min - banheirosDom().min) * 100) /
              (banheirosDom().max - banheirosDom().min) +
            '%'
        }"
        [style.zIndex]="1"
      />
      <input
        type="range"
        [min]="banheirosDom().min"
        [max]="banheirosDom().max"
        [step]="1"
        [(ngModel)]="selBanheiros().max"
        (input)="onBanheirosMaxChange($any($event.target).valueAsNumber)"
        [ngStyle]="{
          '--thumb-max':
            ((selBanheiros().max - banheirosDom().min) * 100) /
              (banheirosDom().max - banheirosDom().min) +
            '%'
        }"
        [style.zIndex]="2"
      />
    </div>
  </div>

  <!-- LAVABOS -->
  <div class="filtro-intervalo">
    <label>Lavabos:</label>
    <div class="intervalo-inputs">
      <input
        type="number"
        [min]="lavabosDom().min"
        [max]="lavabosDom().max"
        [(ngModel)]="selLavabos().min"
        (ngModelChange)="onLavabosMinChange($any($event))"
      />
      <span> até </span>
      <input
        type="number"
        [min]="lavabosDom().min"
        [max]="lavabosDom().max"
        [(ngModel)]="selLavabos().max"
        (ngModelChange)="onLavabosMaxChange($any($event))"
      />
    </div>
    <div class="range-container">
      <input
        type="range"
        [min]="lavabosDom().min"
        [max]="lavabosDom().max"
        [step]="1"
        [(ngModel)]="selLavabos().min"
        (input)="onLavabosMinChange($any($event.target).valueAsNumber)"
        [ngStyle]="{
          '--thumb-min':
            ((selLavabos().min - lavabosDom().min) * 100) /
              (lavabosDom().max - lavabosDom().min) +
            '%'
        }"
        [style.zIndex]="1"
      />
      <input
        type="range"
        [min]="lavabosDom().min"
        [max]="lavabosDom().max"
        [step]="1"
        [(ngModel)]="selLavabos().max"
        (input)="onLavabosMaxChange($any($event.target).valueAsNumber)"
        [ngStyle]="{
          '--thumb-max':
            ((selLavabos().max - lavabosDom().min) * 100) /
              (lavabosDom().max - lavabosDom().min) +
            '%'
        }"
        [style.zIndex]="2"
      />
    </div>
  </div>

  <!-- VAGAS -->
  <div class="filtro-intervalo">
    <label>Vagas:</label>
    <div class="intervalo-inputs">
      <input
        type="number"
        [min]="vagasDom().min"
        [max]="vagasDom().max"
        [(ngModel)]="selVagas().min"
        (ngModelChange)="onVagasMinChange($any($event))"
      />
      <span> até </span>
      <input
        type="number"
        [min]="vagasDom().min"
        [max]="vagasDom().max"
        [(ngModel)]="selVagas().max"
        (ngModelChange)="onVagasMaxChange($any($event))"
      />
    </div>
    <div class="range-container">
      <input
        type="range"
        [min]="vagasDom().min"
        [max]="vagasDom().max"
        [step]="1"
        [(ngModel)]="selVagas().min"
        (input)="onVagasMinChange($any($event.target).valueAsNumber)"
        [ngStyle]="{
          '--thumb-min':
            ((selVagas().min - vagasDom().min) * 100) /
              (vagasDom().max - vagasDom().min) +
            '%'
        }"
        [style.zIndex]="1"
      />
      <input
        type="range"
        [min]="vagasDom().min"
        [max]="vagasDom().max"
        [step]="1"
        [(ngModel)]="selVagas().max"
        (input)="onVagasMaxChange($any($event.target).valueAsNumber)"
        [ngStyle]="{
          '--thumb-max':
            ((selVagas().max - vagasDom().min) * 100) /
              (vagasDom().max - vagasDom().min) +
            '%'
        }"
        [style.zIndex]="2"
      />
    </div>
  </div>

  <!-- PREÇO -->
  <div class="filtro-intervalo">
    <label>Preço (R$):</label>
    <div class="intervalo-inputs">
      <input
        type="number"
        [min]="precoDom().min"
        [max]="precoDom().max"
        [(ngModel)]="selPreco().min"
        (ngModelChange)="onPrecoMinChange($any($event))"
      />
      <span> até </span>
      <input
        type="number"
        [min]="precoDom().min"
        [max]="precoDom().max"
        [(ngModel)]="selPreco().max"
        (ngModelChange)="onPrecoMaxChange($any($event))"
      />
    </div>
    <div class="range-container">
      <input
        type="range"
        [min]="precoDom().min"
        [max]="precoDom().max"
        [step]="1000"
        [(ngModel)]="selPreco().min"
        (input)="onPrecoMinChange($any($event.target).valueAsNumber)"
        [ngStyle]="{
          '--thumb-min':
            ((selPreco().min - precoDom().min) * 100) /
              (precoDom().max - precoDom().min) +
            '%'
        }"
        [style.zIndex]="1"
      />
      <input
        type="range"
        [min]="precoDom().min"
        [max]="precoDom().max"
        [step]="1000"
        [(ngModel)]="selPreco().max"
        (input)="onPrecoMaxChange($any($event.target).valueAsNumber)"
        [ngStyle]="{
          '--thumb-max':
            ((selPreco().max - precoDom().min) * 100) /
              (precoDom().max - precoDom().min) +
            '%'
        }"
        [style.zIndex]="2"
      />
    </div>
  </div>

  <!-- BOTÃO LIMPAR TODOS OS FILTROS -->
  <button class="botao-limpar" (click)="onLimparFiltros()">
    Limpar todos filtros
  </button>
</div>

<!-- ========== GRADE DE CARDS ========== -->
<div class="lista-cards">
  <ng-container *ngFor="let a of apartamentos()">
    <app-card-apartamento [a]="a"></app-card-apartamento>
  </ng-container>
</div>
